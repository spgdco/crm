<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CRM - CIS Grand Couronne</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f4f9; padding:20px; margin:0; }
.container { max-width:900px; margin:auto; background:white; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
h1 { text-align:center; }
.section { background:#eef; padding:15px; border-radius:8px; margin-bottom:20px; }
label { display:block; margin-top:10px; font-weight: bold; }
select, input, textarea { width:100%; padding:8px; margin-top:5px; }
button { padding:12px; background:#007bff; color:white; border:none; border-radius:6px; margin-top:15px; cursor:pointer; }
</style>
</head>
<body>
<div class="container">
<h1>Rapport d'Intervention</h1>

<form id="form">

<div class="section">
<h2>Compte Rendu d'Intervention</h2>
<label>Date d'Intervention :</label>
<input type="date" id="date_intervention">
<label>Numéro de Rapport :</label>
<input type="text" id="num_rapport">
<label>Numéro d'Intervention :</label>
<input type="text" id="num_intervention">
<label>Nature de l'Intervention :</label>
<input type="text" id="nature_intervention">
<label>Adresse de l'Intervention :</label>
<input type="text" id="adresse_intervention">
<label>Action Principale Menée :</label>
<textarea id="action_principale" rows="2"></textarea>
<label>Action Secondaire Menée :</label>
<textarea id="action_secondaire" rows="2"></textarea>
</div>

<!-- Engins -->
<div class="section" id="engins">
<h2>Engins</h2>

<!-- Engin 1 -->
<div>
<h3>Engin 1</h3>
<label>Type d'engin :</label>
<input type="text" id="e1_type">
<label>Chef d'agrès :</label>
<select id="e1_cb" data-equipier><option value="">Choisir...</option></select>
<label>Conducteur :</label>
<select id="e1_cond" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 1 :</label>
<select id="e1_eq1" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 2 :</label>
<select id="e1_eq2" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 3 :</label>
<select id="e1_eq3" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 4 :</label>
<select id="e1_eq4" data-equipier><option value="">Choisir...</option></select>
<label>Appel :</label>
<input type="time" id="e1_appel">
<label>Départ :</label>
<input type="time" id="e1_depart">
<label>Arrivée :</label>
<input type="time" id="e1_arrivee">
<label>DR :</label>
<input type="time" id="e1_dr">
<label>DI :</label>
<input type="time" id="e1_di">
</div>

<!-- Engin 2 -->
<div>
<h3>Engin 2</h3>
<label>Type d'engin :</label>
<input type="text" id="e2_type">
<label>Chef d'agrès :</label>
<select id="e2_cb" data-equipier><option value="">Choisir...</option></select>
<label>Conducteur :</label>
<select id="e2_cond" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 1 :</label>
<select id="e2_eq1" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 2 :</label>
<select id="e2_eq2" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 3 :</label>
<select id="e2_eq3" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 4 :</label>
<select id="e2_eq4" data-equipier><option value="">Choisir...</option></select>
<label>Appel :</label>
<input type="time" id="e2_appel">
<label>Départ :</label>
<input type="time" id="e2_depart">
<label>Arrivée :</label>
<input type="time" id="e2_arrivee">
<label>DR :</label>
<input type="time" id="e2_dr">
<label>DI :</label>
<input type="time" id="e2_di">
</div>

<!-- Engin 3 -->
<div>
<h3>Engin 3</h3>
<label>Type d'engin :</label>
<input type="text" id="e3_type">
<label>Chef d'agrès :</label>
<select id="e3_cb" data-equipier><option value="">Choisir...</option></select>
<label>Conducteur :</label>
<select id="e3_cond" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 1 :</label>
<select id="e3_eq1" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 2 :</label>
<select id="e3_eq2" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 3 :</label>
<select id="e3_eq3" data-equipier><option value="">Choisir...</option></select>
<label>Équipier 4 :</label>
<select id="e3_eq4" data-equipier><option value="">Choisir...</option></select>
<label>Appel :</label>
<input type="time" id="e3_appel">
<label>Départ :</label>
<input type="time" id="e3_depart">
<label>Arrivée :</label>
<input type="time" id="e3_arrivee">
<label>DR :</label>
<input type="time" id="e3_dr">
<label>DI :</label>
<input type="time" id="e3_di">
</div>

</div>

<button type="submit">Générer le Rapport PDF</button>
</form>
</div>

<script>
const equipiers = [
"AGASSE M.","ALFARO C.","BEDINA T.","BENARD S.","BERRENGER Y.","BOUCOURT S.",
"BOUTEILLER K.","CARRET T.","DE MORAIS F.","DELAUNAY A.","DERIAUX M.",
"DHERMANT D.","DOUAY G.","FAURE M.","FILLATRE A.","FOLATRE S.","GAINVILLE F.",
"GANTIER A.","LAURENT G.","LAURENT J.","LAURENT P.","LE TALLEC S.","LEFEBVRE B.",
"LELONG E.","LEMAIRE F.","LENDORMY A.","LHERNAULT A.","MARTOT T.","NICOLAE F.","NIEL A.",
"PRIEUR E.","QUESNOT G.","ROUSSEL PH.","ROYER R.","STOCKLEY CE.","TROLET K.",
"TROLET L.","VAQUETTE N.","VIROT P."
];

function remplirEquipiers() {
  document.querySelectorAll("select[data-equipier]").forEach(sel => {
    equipiers.forEach(eq => {
      const opt = document.createElement("option");
      opt.value = eq;
      opt.textContent = eq;
      sel.appendChild(opt);
    });
  });
}
window.onload = remplirEquipiers;
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const form = document.getElementById("form");
form.addEventListener("submit", function(e){
  e.preventDefault();
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  let y = 10;

  pdf.setFontSize(18);
  pdf.text("Rapport d'Intervention", 105, y, null, null, "center");
  y += 10;
  pdf.setFontSize(12);

  const compteRendu = [
    ["Date d'Intervention", document.getElementById("date_intervention").value || "-"],
    ["Numéro de Rapport", document.getElementById("num_rapport").value || "-"],
    ["Numéro d'Intervention", document.getElementById("num_intervention").value || "-"],
    ["Nature de l'Intervention", document.getElementById("nature_intervention").value || "-"],
    ["Adresse de l'Intervention", document.getElementById("adresse_intervention").value || "-"],
    ["Action Principale Menée", document.getElementById("action_principale").value || "-"],
    ["Action Secondaire Menée", document.getElementById("action_secondaire").value || "-"]
  ];

  const startX = 10;
  let startY = y;
  const rowHeight = 6;
  const col1Width = 60;
  const col2Width = 130;

  // Générer compte rendu
  compteRendu.forEach(row=>{
    if(row[1].trim() !== "-"){
      pdf.rect(startX, startY-4, col1Width, rowHeight);
      pdf.rect(startX + col1Width, startY-4, col2Width, rowHeight);
      pdf.text(row[0], startX+2, startY);
      pdf.text(row[1], startX+col1Width+2, startY);
      startY += rowHeight;
    }
  });
  y = startY + 10;

  const engins = [1,2,3];
  engins.forEach((i)=>{
    const engData = [
      ["Type", document.getElementById(`e${i}_type`).value],
      ["Chef d'agrès", document.getElementById(`e${i}_cb`).value],
      ["Conducteur", document.getElementById(`e${i}_cond`).value],
      ["Équipier 1", document.getElementById(`e${i}_eq1`).value],
      ["Équipier 2", document.getElementById(`e${i}_eq2`).value],
      ["Équipier 3", document.getElementById(`e${i}_eq3`).value],
      ["Équipier 4", document.getElementById(`e${i}_eq4`).value],
      ["Appel", document.getElementById(`e${i}_appel`).value],
      ["Départ", document.getElementById(`e${i}_depart`).value],
      ["Arrivée", document.getElementById(`e${i}_arrivee`).value],
      ["DR", document.getElementById(`e${i}_dr`).value],
      ["DI", document.getElementById(`e${i}_di`).value]
    ];

    // Vérifier si au moins un champ est rempli
    const engFilled = engData.some(row => row[1] && row[1].trim() !== "");
    if(!engFilled) return;

    pdf.setFontSize(14);
    pdf.text(`Engin ${i}`, 10, y); y+=6;
    pdf.setFontSize(12);
    let startYEng = y;

    engData.forEach(row=>{
      if(row[1] && row[1].trim() !== ""){
        pdf.rect(startX, startYEng-4, col1Width, rowHeight);
        pdf.rect(startX + col1Width, startYEng-4, col2Width, rowHeight);
        pdf.text(row[0], startX+2, startYEng);
        pdf.text(row[1], startX+col1Width+2, startYEng);
        startYEng += rowHeight;
      }
    });
    y = startYEng + 6;
  });

  pdf.save("rapport_intervention_engins.pdf");
});
</script>
</body>
</html>
